<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Canva Content Strategy Simulator</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            line-height: 1.6;
            color: #333;
            margin: 0;
            padding: 20px;
            display: flex;
        }
        .main-content {
            flex: 1;
            max-width: 800px;
            padding-right: 20px;
        }
        .floating-budget {
            width: 400px;
            position: fixed;
            top: 20px;
            right: 20px;
            background-color: #f9f9f9;
            border: 1px solid #ddd;
            padding: 15px;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            overflow-y: auto;
            max-height: 95vh;
        }
        h1, h2 {
            color: #4a4a4a;
        }
        label {
            display: block;
            margin-top: 10px;
        }
        input[type="text"], input[type="number"], select, textarea {
            width: 100%;
            padding: 8px;
            margin-top: 5px;
        }
        button {
            background-color: #4CAF50;
            color: white;
            padding: 10px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin-top: 20px;
        }
        button:hover {
            background-color: #45a049;
        }
        #strategyPreview {
            margin-top: 20px;
            border: 1px solid #ddd;
            padding: 10px;
            white-space: pre-wrap;
        }
        .strategy-section {
            border: 1px solid #ddd;
            padding: 15px;
            margin-top: 20px;
            position: relative;
        }
        .remove-strategy {
            position: absolute;
            top: 10px;
            right: 10px;
            background-color: #f44336;
            color: white;
            border: none;
            padding: 5px 10px;
            cursor: pointer;
        }
        .error {
            color: red;
            font-weight: bold;
        }
        #strategyList {
            margin-top: 15px;
            border-top: 1px solid #ddd;
            padding-top: 15px;
        }
        .strategy-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
        }
        .chart-container {
            margin-top: 20px;
            height: 300px;
            width: 100%;
        }
    </style>
</head>
<body>
    <div class="main-content">
        <h1>Canva Content Strategy Simulator</h1>
        <form id="strategyForm">
            <div id="strategyContainer"></div>
            <button type="button" onclick="addStrategy()">+ Add Content Strategy</button>
            <button type="button" onclick="previewStrategy()">Preview Strategy</button>
            <button type="button" onclick="downloadCSV()">Download CSV</button>
        </form>
        <div id="strategyPreview"></div>
    </div>
    
    <div class="floating-budget">
        <h2>Budget Overview</h2>
        <label for="quarterlyBudget">Total Quarterly Budget:</label>
        <input type="number" id="quarterlyBudget" name="quarterlyBudget" value="5000000" min="1000000" max="10000000" onchange="updateTotalBudget()">
        <p id="totalBudget">Remaining Budget: $5,000,000</p>
        <div id="strategyList"></div>
        <div class="chart-container">
            <canvas id="audienceChart"></canvas>
        </div>
        <div class="chart-container">
            <canvas id="channelChart"></canvas>
        </div>
    </div>

    <script>
        let strategyCount = 0;
        let audienceChart, channelChart;

        function addStrategy() {
            strategyCount++;
            const container = document.getElementById('strategyContainer');
            const section = document.createElement('div');
            section.className = 'strategy-section';
            section.innerHTML = `
                <h2>Content Strategy #${strategyCount}</h2>
                <button type="button" class="remove-strategy" onclick="removeStrategy(this)">Remove</button>
                <label for="campaignName${strategyCount}">Campaign Name:</label>
                <input type="text" id="campaignName${strategyCount}" name="campaignName${strategyCount}" required oninput="updateStrategyList()">
                
                <label for="budget${strategyCount}">Budget:</label>
                <input type="number" id="budget${strategyCount}" name="budget${strategyCount}" min="0" value="0" oninput="updateBudgetValue(this)">
                
                <label for="channel${strategyCount}">Channel:</label>
                <select id="channel${strategyCount}" name="channel${strategyCount}" required onchange="updateCharts()">
                    <option value="podcast">Podcast Sponsorships</option>
                    <option value="social">Social Media</option>
                    <option value="blog">Blog</option>
                    <option value="email">Email Marketing</option>
                    <option value="seo">SEO</option>
                    <option value="ppc">PPC Advertising</option>
                </select>
                
                <label for="audience${strategyCount}">Audience Targeting:</label>
                <select id="audience${strategyCount}" name="audience${strategyCount}" required onchange="updateCharts()">
                    <option value="small_business">Small Business Owners</option>
                    <option value="designers">Professional Designers</option>
                    <option value="marketers">Digital Marketers</option>
                    <option value="students">Students</option>
                    <option value="educators">Educators</option>
                    <option value="nonprofits">Non-Profit Organizations</option>
                    <option value="enterprise">Enterprise Companies</option>
                </select>
                
                <label for="kpi${strategyCount}">Key Performance Indicator:</label>
                <select id="kpi${strategyCount}" name="kpi${strategyCount}" required>
                    <option value="user_acquisition">New User Acquisition</option>
                    <option value="conversion_rate">Conversion Rate</option>
                    <option value="engagement">User Engagement</option>
                    <option value="retention">User Retention</option>
                    <option value="revenue">Revenue Growth</option>
                    <option value="brand_awareness">Brand Awareness</option>
                    <option value="feature_adoption">Feature Adoption</option>
                </select>
                
                <label for="strategy${strategyCount}">Additional Strategy Information:</label>
                <textarea id="strategy${strategyCount}" name="strategy${strategyCount}" rows="4"></textarea>
            `;
            container.appendChild(section);
            updateTotalBudget();
        }

        function removeStrategy(button) {
            const section = button.parentElement;
            section.parentElement.removeChild(section);
            updateTotalBudget();
        }

        function updateBudgetValue(input) {
            updateTotalBudget();
        }

        function updateStrategyList() {
            const strategyList = document.getElementById('strategyList');
            strategyList.innerHTML = ''; // Clear existing list

            const strategies = document.querySelectorAll('.strategy-section');
            strategies.forEach((strategy, index) => {
                const campaignNameInput = strategy.querySelector('input[name^="campaignName"]');
                const budgetInput = strategy.querySelector('input[name^="budget"]');
                
                const campaignName = campaignNameInput.value || `Strategy #${index + 1}`;
                const budgetValue = parseInt(budgetInput.value) || 0;

                const strategyItem = document.createElement('div');
                strategyItem.className = 'strategy-item';
                strategyItem.innerHTML = `
                    <span>${campaignName}:</span>
                    <span>$${budgetValue.toLocaleString()}</span>
                `;
                strategyList.appendChild(strategyItem);
            });

            updateCharts();
        }

        function updateTotalBudget() {
            const totalBudgetElement = document.getElementById('quarterlyBudget');
            const totalBudgetDisplayElement = document.getElementById('totalBudget');
            
            if (!totalBudgetElement || !totalBudgetDisplayElement) return;

            const totalBudget = parseInt(totalBudgetElement.value);
            let allocatedBudget = 0;
            const budgetInputs = document.querySelectorAll('input[name^="budget"]');
            
            budgetInputs.forEach(input => {
                allocatedBudget += parseInt(input.value) || 0;
            });

            const remainingBudget = totalBudget - allocatedBudget;
            totalBudgetDisplayElement.textContent = `Remaining Budget: $${remainingBudget.toLocaleString()}`;
            totalBudgetDisplayElement.className = remainingBudget < 0 ? 'error' : '';

            updateStrategyList();
        }

        function updateCharts() {
            const strategies = document.querySelectorAll('.strategy-section');
            const audienceData = {};
            const channelData = {};

            strategies.forEach(strategy => {
                const budget = parseInt(strategy.querySelector('input[name^="budget"]').value) || 0;
                const audience = strategy.querySelector('select[name^="audience"]').value;
                const channel = strategy.querySelector('select[name^="channel"]').value;

                audienceData[audience] = (audienceData[audience] || 0) + budget;
                channelData[channel] = (channelData[channel] || 0) + budget;
            });

            console.log('Audience Data:', audienceData);
            console.log('Channel Data:', channelData);

            createOrUpdateChart('audienceChart', 'Audience Budget Allocation', audienceData);
            createOrUpdateChart('channelChart', 'Channel Budget Allocation', channelData);
        }

        function createOrUpdateChart(canvasId, title, data) {
            const ctx = document.getElementById(canvasId).getContext('2d');
            const chartData = {
                labels: Object.keys(data),
                datasets: [{
                    data: Object.values(data),
                    backgroundColor: [
                        '#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0', '#9966FF', '#FF9F40', '#FF6384'
                    ]
                }]
            };

            if (window[canvasId]) {
                window[canvasId].data = chartData;
                window[canvasId].update();
            } else {
                window[canvasId] = new Chart(ctx, {
                    type: 'pie',
                    data: chartData,
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            title: {
                                display: true,
                                text: title
                            },
                            legend: {
                                position: 'bottom'
                            }
                        }
                    }
                });
            }
        }

        function previewStrategy() {
            const form = document.getElementById('strategyForm');
            const preview = document.getElementById('strategyPreview');
            preview.textContent = '';
            const totalBudget = document.getElementById('quarterlyBudget').value;
            preview.textContent += `Total Quarterly Budget: $${parseInt(totalBudget).toLocaleString()}\n\n`;
            const strategies = document.querySelectorAll('.strategy-section');
            strategies.forEach((strategy, index) => {
                preview.textContent += `Content Strategy #${index + 1}\n`;
                const inputs = strategy.querySelectorAll('input, select, textarea');
                inputs.forEach(input => {
                    if (input.name) {
                        let value = input.value;
                        if (input.name.startsWith('budget')) {
                            value = '$' + parseInt(value).toLocaleString();
                        }
                        preview.textContent += `${input.name}: ${value}\n`;
                    }
                });
                preview.textContent += '\n';
            });
        }

        function downloadCSV() {
            const totalBudget = document.getElementById('quarterlyBudget').value;
            const strategies = document.querySelectorAll('.strategy-section');
            const data = strategies.map((strategy, index) => {
                const strategyData = {
                    'Strategy Number': index + 1,
                    'Total Quarterly Budget': '$' + parseInt(totalBudget).toLocaleString()
                };
                const inputs = strategy.querySelectorAll('input, select, textarea');
                inputs.forEach(input => {
                    if (input.name) {
                        let value = input.value;
                        if (input.name.startsWith('budget')) {
                            value = '$' + parseInt(value).toLocaleString();
                        }
                        strategyData[input.name] = value;
                    }
                });
                return strategyData;
            });

            if (data.length === 0) {
                alert("No strategies to download. Please add at least one strategy.");
                return;
            }

            try {
                const csv = Papa.unparse(data);
                const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
                const link = document.createElement('a');
                if (link.download !== undefined) {
                    const url = URL.createObjectURL(blob);
                    link.setAttribute('href', url);
                    link.setAttribute('download', 'canva_content_strategies.csv');
                    link.style.visibility = 'hidden';
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                } else {
                    alert("Your browser doesn't support downloading CSV files. Please try a different browser.");
                }
            } catch (error) {
                console.error("Error generating CSV:", error);
                alert("An error occurred while generating the CSV file. Please try again.");
            }
        }

        // Initialize with one strategy and charts
        window.onload = function() {
            addStrategy();
            updateCharts();
        };
    </script>
</body>
</html>
